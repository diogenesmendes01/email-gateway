# ==============================================================================
# EMAIL GATEWAY - Environment Variables
# ==============================================================================
# âš ï¸  IMPORTANTE: Este Ã© um arquivo de EXEMPLO. NUNCA commite credenciais reais!
#
# Setup:
# 1. Copie este arquivo: cp .env.example .env
# 2. Substitua todos os valores EXAMPLE por valores reais
# 3. Adicione .env ao .gitignore (jÃ¡ deve estar)
# 4. Para gerar chaves seguras: openssl rand -base64 32
# ==============================================================================

# ------------------------------------------------------------------------------
# Application
# ------------------------------------------------------------------------------
NODE_ENV=development                    # development | staging | production
API_PORT=3000                          # Porta da API REST
WORKER_PORT=3001                       # Porta do worker (health checks)

# API Configuration
API_PREFIX=v1                          # Prefixo da API (ex: /v1/email/send)

# ------------------------------------------------------------------------------
# Database (PostgreSQL)
# ------------------------------------------------------------------------------
# âš ï¸  NUNCA commite connection strings de produÃ§Ã£o!
# Em produÃ§Ã£o, use secrets manager (AWS Secrets, HashiCorp Vault, Doppler, etc.)
#
# Formato: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/email_gateway?schema=public"

# ------------------------------------------------------------------------------
# Redis (Queue & Cache)
# ------------------------------------------------------------------------------
# BullMQ usa Redis para gerenciar fila de emails
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=                         # Deixe vazio se sem senha (dev apenas)
REDIS_DB=0                             # Banco Redis (0-15)

# Alternativa: Use REDIS_URL para connection string completa
# REDIS_URL=redis://:password@localhost:6379/0

# ------------------------------------------------------------------------------
# BullMQ Queue Configuration
# ------------------------------------------------------------------------------
QUEUE_NAME=email:send                  # Nome da fila no Redis
QUEUE_CONCURRENCY=2                    # Workers processando simultaneamente
QUEUE_MAX_RETRIES=5                    # MÃ¡ximo de tentativas por job

# Worker Configuration
WORKER_CONCURRENCY=16                  # Threads de processamento: min(CPU*2, 16)

# ------------------------------------------------------------------------------
# AWS SES (Simple Email Service)
# ------------------------------------------------------------------------------
# âš ï¸  NUNCA commite credenciais AWS reais!
#
# ðŸ“Œ DESENVOLVIMENTO LOCAL - Escolha uma opÃ§Ã£o:
#   OpÃ§Ã£o 1 (Recomendada): Use AWS CLI profile
#     - Configure: aws configure --profile email-gateway
#     - Use: AWS_PROFILE=email-gateway npm run dev
#
#   OpÃ§Ã£o 2: Use variÃ¡veis de ambiente (abaixo)
#     - Apenas para testes locais
#     - NUNCA commite estas credenciais
#
# ðŸš€ PRODUÃ‡ÃƒO - Use IAM Roles (NUNCA hardcode keys):
#   - ECS Task Role
#   - EC2 Instance Profile
#   - Lambda Execution Role
#   - EKS Service Account (IRSA)
#
# Os valores abaixo sÃ£o EXEMPLOS OFICIAIS DA AWS e NÃƒO FUNCIONAM:
# ReferÃªncia: https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html

AWS_REGION=us-east-1                   # RegiÃ£o SES: us-east-1, us-west-2, eu-west-1, etc.

# âš ï¸  Estes sÃ£o exemplos da documentaÃ§Ã£o oficial da AWS - NÃƒO FUNCIONAM!
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

# SES Configuration
SES_FROM_ADDRESS=noreply@example.com   # Email verificado no SES (required)
SES_REPLY_TO_ADDRESS=support@example.com
SES_CONFIGURATION_SET_NAME=email-gateway # Nome do Configuration Set (opcional)

# SES Sandbox Mode (Development)
# SES sandbox sÃ³ permite enviar para emails verificados
# Para produÃ§Ã£o, solicite "SES Production Access" no AWS Console

# ------------------------------------------------------------------------------
# Security & Authentication
# ------------------------------------------------------------------------------
# API Key Configuration
API_KEY_HEADER=x-api-key               # Nome do header para API key

# CORS Configuration
CORS_ORIGIN=http://localhost:3000      # Origens permitidas (use * com cuidado)
                                       # Em produÃ§Ã£o: https://app.example.com

# IP Whitelist (opcional)
ALLOWED_IPS=127.0.0.1,::1              # IPs permitidos (deixe vazio para desabilitar)

# ------------------------------------------------------------------------------
# Encryption (CRITICAL - Required for PII Protection)
# ------------------------------------------------------------------------------
# âš ï¸  OBRIGATÃ“RIO para proteger CPF/CNPJ no banco de dados!
#
# Como gerar:
#   openssl rand -base64 32
#   node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
#
# Requisitos:
#   - MÃ­nimo 32 caracteres (256 bits)
#   - Alta entropia (use geradores criptogrÃ¡ficos)
#   - NUNCA use valores de exemplo/placeholder
#   - Guarde em secret manager em produÃ§Ã£o
#
# ðŸ”’ PRODUÃ‡ÃƒO: Use AWS Secrets Manager, HashiCorp Vault, ou equivalente

ENCRYPTION_KEY=                        # âš ï¸  OBRIGATÃ“RIO - Gere com: openssl rand -base64 32

# Optional: Separate salt secret (uses ENCRYPTION_KEY if not set)
ENCRYPTION_SALT_SECRET=

# Encryption Performance Monitoring
ENCRYPTION_SLOW_THRESHOLD_MS=200       # Log warning se encryption > 200ms

# ------------------------------------------------------------------------------
# Logging
# ------------------------------------------------------------------------------
LOG_LEVEL=info                         # debug | info | warn | error
LOG_FORMAT=json                        # json | pretty (use json em produÃ§Ã£o)

# ------------------------------------------------------------------------------
# Rate Limiting & Throttling
# ------------------------------------------------------------------------------
# API Rate Limits (por IP)
RATE_LIMIT_TTL=60                      # Janela de tempo (segundos)
RATE_LIMIT_LIMIT=100                   # MÃ¡ximo de requests na janela

# Payload Limits
MAX_PAYLOAD_SIZE=1mb                   # Tamanho mÃ¡ximo do body

# ------------------------------------------------------------------------------
# Retry & Backoff Configuration
# ------------------------------------------------------------------------------
# ConfiguraÃ§Ã£o de retry para falhas transientes
RETRY_BASE_DELAY=1000                  # Delay inicial (ms)
RETRY_MAX_DELAY=60000                  # Delay mÃ¡ximo (ms)
RETRY_EXPONENTIAL_FACTOR=2             # Fator de multiplicaÃ§Ã£o

# ------------------------------------------------------------------------------
# Health Check Configuration
# ------------------------------------------------------------------------------
# SES Quota Monitoring
SES_QUOTA_WARNING_THRESHOLD=0.8        # Alerta em 80% da quota
SES_QUOTA_CRITICAL_THRESHOLD=0.95      # CrÃ­tico em 95% da quota

# ------------------------------------------------------------------------------
# Testing & Development
# ------------------------------------------------------------------------------
# Chaos Engineering (apenas dev/staging)
# CHAOS_SES_429=false                   # Simula throttling do SES
# CHAOS_DB_SLOW=false                   # Simula latÃªncia do banco
# CHAOS_REDIS_DOWN=false                # Simula Redis indisponÃ­vel

# Test Database (E2E tests)
# DATABASE_TEST_URL="postgresql://postgres:postgres@localhost:5432/email_gateway_test?schema=public"

# ------------------------------------------------------------------------------
# Observability (Opcional)
# ------------------------------------------------------------------------------
# Metrics & Monitoring
# PROMETHEUS_PORT=9090
# GRAFANA_URL=http://localhost:3001

# Tracing (OpenTelemetry)
# OTEL_ENABLED=false
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
# OTEL_SERVICE_NAME=email-gateway

# Sentry Error Tracking
# SENTRY_DSN=
# SENTRY_ENVIRONMENT=development
# SENTRY_TRACES_SAMPLE_RATE=0.1

# ------------------------------------------------------------------------------
# Feature Flags (Opcional)
# ------------------------------------------------------------------------------
# FEATURE_CIRCUIT_BREAKER=true
# FEATURE_ENCRYPTION_MONITORING=true
# FEATURE_DNS_VERIFICATION=true

# ------------------------------------------------------------------------------
# TASK-021: DLQ Monitoring & Admin (REQUIRED)
# ------------------------------------------------------------------------------
# Dead Letter Queue Management
# Endpoints: /admin/dlq

# Admin API Key (REQUIRED for DLQ management)
# âš ï¸  CRITICAL: Generate strong key and keep secure!
# Como gerar: openssl rand -base64 32
ADMIN_API_KEY=                         # âš ï¸  OBRIGATÃ“RIO - Protege endpoints admin

# DLQ Alert Thresholds
DLQ_ALERT_THRESHOLD=10                 # Alerta se DLQ > 10 jobs
DLQ_CRITICAL_THRESHOLD=100             # CrÃ­tico se DLQ > 100 jobs
DLQ_MAX_AGE_HOURS=24                  # Alerta se job > 24h no DLQ

# Slack Alerts (Opcional mas Recomendado)
# Configure webhook em: https://api.slack.com/messaging/webhooks
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# Admin Panel URLs (para links em alertas)
API_BASE_URL=http://localhost:3000     # URL base da API
GRAFANA_URL=http://localhost:3001      # URL do Grafana

# DLQ Monitoring
DLQ_CHECK_INTERVAL_MS=300000          # Check DLQ a cada 5 minutos (300000ms)
DLQ_CLEANUP_DAYS=7                     # Limpar jobs com > 7 dias no DLQ

# ==============================================================================
# FIM - Email Gateway Environment Variables
# ==============================================================================
